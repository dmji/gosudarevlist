package pages

import "fmt"

type ScanResult struct {
	ID       int
	Name     string
	Status   string
	Progress int
	Date     string
}

templ Results(results []ScanResult) {
	if len(results) == 0 {
		<tr>
			<td colspan="5" class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center">No results yet. Click "Scan" to start.</td>
		</tr>
	} else {
		for _, result := range results {
			<tr>
				<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{ fmt.Sprint(result.ID) }</td>
				<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{ result.Name }</td>
				<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{ result.Status }</td>
				<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{ fmt.Sprintf("%d%%", result.Progress) }</td>
				<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{ result.Date }</td>
			</tr>
		}
		<tr>
			<td colspan="5" class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center">Last result. I forgot why I add this</td>
		</tr>
	}
}

templ Scanner(results []ScanResult) {
	@layout("AnimeLayer Scan") {
		<div class="container mx-auto w-4/5 max-w-4xl">
			<h1 class="text-3xl font-bold mb-6 text-center">AnimeLayer Scanner</h1>
			<div class="bg-gray-200 rounded-full mb-6">
				@ProgressBar(0)
			</div>
			<button
				class="w-full bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mb-6"
				hx-post="/api/animelayer/scan"
				hx-target="#results"
				hx-trigger="click"
				hx-indicator="#progress-bar"
				hx-swap="innerHTML"
			>
				Scan
			</button>
			<div class="h-120 overflow-y-auto bg-white rounded-lg shadow">
				<table class="w-full">
					<thead>
						<tr class="bg-gray-50">
							<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
							<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
							<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
							<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Progress</th>
							<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
						</tr>
					</thead>
					<tbody id="results" class="bg-white divide-y divide-gray-200">
						@Results(results)
					</tbody>
				</table>
			</div>
		</div>
	}
}

templ ProgressBar(progress int) {
	<div
		id="progress-bar"
		class="bg-green-500 h-2 rounded-full transition-all duration-500 ease-in-out"
		style="width: 14%"
	></div>
}
